<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>拓展新的服务模块 | Mog</title>
    <meta name="description" content="一款弹性的模块化 CMS 博客系统">
    <link rel="preload stylesheet" href="/assets/style.c6eb64a0.css" as="style">
    <link rel="modulepreload" href="/assets/app.bbe1740c.js">
    <link rel="modulepreload" href="/assets/developer_extend-service.md.51a30c08.lean.js">
    <link rel="prefetch" href="/assets/chunks/VPAlgoliaSearchBox.17f39d26.js">
    <link rel="icon" href="/logo.svg">
  <link rel="preload" href="/assets/inter-latin.7b37fe23.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <meta name="theme-color" content="#729b1a">
  <link rel="icon" href="/logo.svg" type="image/svg+xml">
  <link rel="alternate icon" href="/favicon.ico" type="image/png" sizes="16x16">
  <meta name="author" content="Wibus, MYXXTS, ttimochan, Origami, Guaguamiao, Rils_s and Mog contributors">
  <meta name="keywords" content="vitest, vite, test, coverage, snapshot, react, vue, preact, svelte, solid, lit, ruby, cypress, puppeteer, jsdom, happy-dom, test-runner, jest, typescript, esm, tinypool, tinyspy, c8, node">
  <meta property="og:title" content="Mog">
  <meta property="og:description" content="一款永向未来的 CMS 博客系统">
  <meta property="og:url" content="https://mog.js.org">
  <meta property="og:image" content="https://mog.js.org/logo.svg">
  <meta name="twitter:title" content="Mog">
  <meta name="twitter:description" content="一款永向未来的 CMS 博客系统">
  <meta name="twitter:image" content="https://mog.js.org/logo.svg">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="mask-icon" href="/logo.svg" color="#ffffff">
  <script async="" defer="" data-website-id="db355c05-e3d6-4e4c-a813-fccbc15e39b0" src="https://umami.iucky.cn/umami.js"></script>
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="VPApp" data-v-732aa6ea><!--[--><span tabindex="-1" data-v-4adb7891></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-4adb7891>Skip to content</a><!--]--><!----><!--[--><!--]--><header class="VPNav nav-bar" data-v-732aa6ea data-v-a4338531><div class="VPNavBar" data-v-a4338531 data-v-e46bbdf7><div class="container" data-v-e46bbdf7><a class="VPNavBarTitle" href="/" data-v-e46bbdf7 data-v-a2cce4ab><svg width="45px" height="25px" id="图层_1" data-name="图层 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" data-v-a2cce4ab><defs data-v-a2cce4ab><linearGradient id="未命名的渐变_586" y1="250" x2="500" y2="250" gradientUnits="userSpaceOnUse" data-v-a2cce4ab><stop offset="0" stop-color="#9fd9f6" data-v-a2cce4ab></stop><stop offset="1" stop-color="#fcdfb5" data-v-a2cce4ab></stop></linearGradient></defs><rect id="矩形" class="cls-1" width="500" height="500" rx="105" data-v-a2cce4ab></rect><rect id="矩形-2" data-name="矩形" class="cls-2" x="30.73" y="30.73" width="438.54" height="438.54" rx="92.09" data-v-a2cce4ab></rect><g class="cls-3" data-v-a2cce4ab><path id="矩形-3" data-name="矩形" class="cls-4" d="M101.81,93.63h74.25a11.77,11.77,0,0,1,12,11.5h0a11.77,11.77,0,0,1-12,11.5H101.81a11.78,11.78,0,0,1-12-11.5h0A11.78,11.78,0,0,1,101.81,93.63Z" data-v-a2cce4ab></path><path id="矩形备份-4" class="cls-4" d="M213.66,93.63h74.25a11.77,11.77,0,0,1,12,11.5h0a11.77,11.77,0,0,1-12,11.5H213.66a11.77,11.77,0,0,1-12-11.5h0A11.77,11.77,0,0,1,213.66,93.63Z" data-v-a2cce4ab></path><path id="矩形备份-6" class="cls-4" d="M325.5,93.63h74.25a11.77,11.77,0,0,1,12,11.5h0a11.77,11.77,0,0,1-12,11.5H325.5a11.77,11.77,0,0,1-12-11.5h0A11.77,11.77,0,0,1,325.5,93.63Z" data-v-a2cce4ab></path><path id="矩形-4" data-name="矩形" class="cls-4" d="M114.13,274.72h69.2a11.35,11.35,0,0,1,11.21,11.5h0a11.35,11.35,0,0,1-11.21,11.5h-69.2a11.36,11.36,0,0,1-11.21-11.5h0A11.36,11.36,0,0,1,114.13,274.72Z" data-v-a2cce4ab></path><path id="矩形备份-4-2" data-name="矩形备份-4" class="cls-4" d="M217,274.72h69.2a11.36,11.36,0,0,1,11.21,11.5h0a11.36,11.36,0,0,1-11.21,11.5H217a11.36,11.36,0,0,1-11.21-11.5h0A11.36,11.36,0,0,1,217,274.72Z" data-v-a2cce4ab></path><path id="矩形备份-6-2" data-name="矩形备份-6" class="cls-4" d="M319.79,274.72H389a11.36,11.36,0,0,1,11.21,11.5h0A11.36,11.36,0,0,1,389,297.72h-69.2a11.36,11.36,0,0,1-11.21-11.5h0A11.36,11.36,0,0,1,319.79,274.72Z" data-v-a2cce4ab></path><path id="矩形备份-5" class="cls-4" d="M277.94,129.84h85a11.5,11.5,0,0,1,11.5,11.5h0a11.5,11.5,0,0,1-11.5,11.5h-85a11.5,11.5,0,0,1-11.5-11.5h0A11.5,11.5,0,0,1,277.94,129.84Z" data-v-a2cce4ab></path><path id="矩形备份-2" class="cls-4" d="M146.44,129.84h101a11.5,11.5,0,0,1,11.5,11.5h0a11.5,11.5,0,0,1-11.5,11.5h-101a11.5,11.5,0,0,1-11.5-11.5h0A11.5,11.5,0,0,1,146.44,129.84Z" data-v-a2cce4ab></path><path id="矩形备份-3" class="cls-4" d="M123.91,166.06h260a11.5,11.5,0,0,1,11.5,11.5h0a11.5,11.5,0,0,1-11.5,11.5h-260a11.5,11.5,0,0,1-11.5-11.5h0A11.5,11.5,0,0,1,123.91,166.06Z" data-v-a2cce4ab></path><path id="矩形备份-3-2" data-name="矩形备份-3" class="cls-4" d="M123.12,347.16h260a11.49,11.49,0,0,1,11.5,11.5h0a11.5,11.5,0,0,1-11.5,11.5h-260a11.5,11.5,0,0,1-11.5-11.5h0A11.5,11.5,0,0,1,123.12,347.16Z" data-v-a2cce4ab></path><path id="矩形备份-7" class="cls-4" d="M104.69,202.28h137c5.76,0,10.44,5.15,10.44,11.5h0c0,6.35-4.68,11.5-10.44,11.5h-137c-5.77,0-10.44-5.15-10.44-11.5h0C94.25,207.43,98.92,202.28,104.69,202.28Z" data-v-a2cce4ab></path><path id="矩形备份-8" class="cls-4" d="M270.77,202.28h137c5.77,0,10.44,5.15,10.44,11.5h0c0,6.35-4.67,11.5-10.44,11.5h-137c-5.76,0-10.44-5.15-10.44-11.5h0C260.33,207.43,265,202.28,270.77,202.28Z" data-v-a2cce4ab></path><path id="矩形备份-12" class="cls-4" d="M155.72,310.94h64a11.5,11.5,0,0,1,11.5,11.5h0a11.5,11.5,0,0,1-11.5,11.5h-64a11.5,11.5,0,0,1-11.5-11.5h0A11.5,11.5,0,0,1,155.72,310.94Z" data-v-a2cce4ab></path><path id="矩形备份-16" class="cls-4" d="M254.22,310.94h101a11.5,11.5,0,0,1,11.5,11.5h0a11.5,11.5,0,0,1-11.5,11.5h-101a11.5,11.5,0,0,1-11.5-11.5h0A11.5,11.5,0,0,1,254.22,310.94Z" data-v-a2cce4ab></path><path id="矩形备份-15" class="cls-4" d="M303.08,383.37H407.35c6,0,10.9,5.15,10.9,11.5h0c0,6.35-4.88,11.5-10.9,11.5H303.08c-6,0-10.9-5.15-10.9-11.5h0C292.18,388.52,297.06,383.37,303.08,383.37Z" data-v-a2cce4ab></path><path id="矩形备份-14" class="cls-4" d="M92.65,383.37H269.91c6,0,10.9,5.15,10.9,11.5h0c0,6.35-4.88,11.5-10.9,11.5H92.65c-6,0-10.9-5.15-10.9-11.5h0C81.75,388.52,86.63,383.37,92.65,383.37Z" data-v-a2cce4ab></path><path id="矩形备份-9" class="cls-4" d="M114.05,238.5H255.87c6,0,10.8,5.15,10.8,11.5h0c0,6.35-4.84,11.5-10.8,11.5H114.05c-6,0-10.8-5.15-10.8-11.5h0C103.25,243.65,108.09,238.5,114.05,238.5Z" data-v-a2cce4ab></path><path id="矩形备份-10" class="cls-4" d="M287.33,238.5h103.3c6,0,10.8,5.15,10.8,11.5h0c0,6.35-4.83,11.5-10.8,11.5H287.33c-6,0-10.8-5.15-10.8-11.5h0C276.53,243.65,281.36,238.5,287.33,238.5Z" data-v-a2cce4ab></path></g><g id="T" data-v-a2cce4ab><path id="路径" class="cls-5" d="M314.14,131.46A20.55,20.55,0,0,1,328,136.32c3.86,3.33,6.12,8,6.12,14.46,0,7.71-3,12.45-7.65,15.22a23.67,23.67,0,0,1-12.35,3.46H270v178.8c0,6.46-1.66,11.1-4.21,14.27-2.71,3.39-7.57,6-15.79,6s-13.17-2.73-15.9-6.31c-2.53-3.31-4.1-7.89-4.1-14h0V169.46H185.86c-5.83,0-10.32-1.53-13.68-4.09-3.73-2.84-6.32-7.51-6.32-14.91,0-7,2.51-11.68,6.44-14.72a21.54,21.54,0,0,1,13.56-4.28H314.14Z" data-v-a2cce4ab></path></g></svg><span class="text" data-v-a2cce4ab>Mog</span></a><div class="content" data-v-e46bbdf7><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-e46bbdf7 data-v-4048c04b><span id="main-nav-aria-label" class="visually-hidden" data-v-4048c04b>Main Navigation</span><!--[--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/guide/" data-v-4048c04b data-v-cd38b960><!--[-->指南<!--]--><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/install/" data-v-4048c04b data-v-cd38b960><!--[-->进阶安装<!--]--><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/migrate/" data-v-4048c04b data-v-cd38b960><!--[-->迁移<!--]--><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/config/" data-v-4048c04b data-v-cd38b960><!--[-->配置<!--]--><!----></a><!--]--><!--[--><div class="vt-flyout VPNavBarMenuGroup" data-v-4048c04b data-v-cb90c889><button type="button" class="vt-flyout-button" aria-haspopup="true" aria-expanded="false"><!--[--><span class="vt-flyout-button-text">生态系统 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-flyout-button-text-icon"><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span><!--]--></button><div class="vt-flyout-menu"><div class="vt-menu"><div class="vt-menu-items"><!--[--><!--[--><div class="vt-menu-group"><p class="vt-menu-group-title">官方与社区</p><!--[--><!--[--><a class="vt-link link vt-menu-link" href="https://github.com/mogland/awesome-mog" target="_blank" rel="noopener noreferrer"><!--[-->Awesome-Mog<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="vt-link-icon"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a><!--]--><!--]--></div><!--]--><!--[--><div class="vt-menu-group"><p class="vt-menu-group-title">核心组件</p><!--[--><!--[--><a class="vt-link link vt-menu-link" href="https://github.com/mogland/core" target="_blank" rel="noopener noreferrer"><!--[-->Mog-Core<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="vt-link-icon"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a><!--]--><!--[--><a class="vt-link link vt-menu-link" href="https://github.com/mogland/console" target="_blank" rel="noopener noreferrer"><!--[-->Mog-Console<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="vt-link-icon"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a><!--]--><!--[--><a class="vt-link link vt-menu-link" href="https://github.com/mogland/MNE" target="_blank" rel="noopener noreferrer"><!--[-->Mog-MNE<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="vt-link-icon"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a><!--]--><!--]--></div><!--]--><!--[--><div class="vt-menu-group"><p class="vt-menu-group-title">评论组件</p><!--[--><!--[--><a class="vt-link link vt-menu-link" href="https://github.com/mogland/mog-comments-wc" target="_blank" rel="noopener noreferrer"><!--[-->Mog-Comments-WC<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="vt-link-icon"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a><!--]--><!--[--><a class="vt-link link vt-menu-link" href="https://github.com/mogland/mog-comments-react" target="_blank" rel="noopener noreferrer"><!--[-->Mog-Comments-React<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="vt-link-icon"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a><!--]--><!--]--></div><!--]--><!--[--><div class="vt-menu-group"><p class="vt-menu-group-title">前端主题</p><!--[--><!--[--><a class="vt-link link vt-menu-link" href="https://github.com/mogland/mog-theme-tiny" target="_blank" rel="noopener noreferrer"><!--[-->Mog-Theme-Tiny<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="vt-link-icon"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a><!--]--><!--[--><a class="vt-link link vt-menu-link" href="https://github.com/mogland/mog-theme-Single" target="_blank" rel="noopener noreferrer"><!--[-->Mog-Theme-Single<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="vt-link-icon"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vt-flyout VPNavBarMenuGroup" data-v-4048c04b data-v-cb90c889><button type="button" class="vt-flyout-button" aria-haspopup="true" aria-expanded="false"><!--[--><span class="vt-flyout-button-text">关于 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-flyout-button-text-icon"><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span><!--]--></button><div class="vt-flyout-menu"><div class="vt-menu"><div class="vt-menu-items"><!--[--><!--[--><a class="vt-link link vt-menu-link" href="/about/faq.html"><!--[-->常见问题<!--]--><!----></a><!--]--><!--[--><a class="vt-link link vt-menu-link" href="/about/roadmap.html"><!--[-->RoadMap<!--]--><!----></a><!--]--><!--[--><a class="vt-link link vt-menu-link" href="/about/releases.html"><!--[-->版本发布<!--]--><!----></a><!--]--><!--[--><a class="vt-link link vt-menu-link" href="/about/code-of-conduct.html"><!--[-->行为准则<!--]--><!----></a><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--><!----></nav><div class="VPNavBarAppearance appearance" data-v-e46bbdf7 data-v-25166889><button class="vt-switch vt-switch-appearance" type="button" role="switch" aria-label="Toggle dark mode" data-v-25166889><span class="vt-switch-check"><span class="vt-switch-icon"><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-sun"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-moon"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="vt-social-links VPNavBarSocialLinks social-links" data-v-e46bbdf7 data-v-e94f6609><!--[--><a class="vt-social-link is-small" href="https://github.com/mogland" title="github" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-social-link-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden">github</span></a><!--]--></div><div class="vt-flyout VPNavBarExtra extra" data-v-e46bbdf7 data-v-0e8a8aa1><button type="button" class="vt-flyout-button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation"><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-flyout-button-icon"><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg><!--]--></button><div class="vt-flyout-menu"><div class="vt-menu"><!----><!--[--><!--[--><div class="vt-menu-group" data-v-0e8a8aa1><div class="vt-menu-item item" data-v-0e8a8aa1><p class="vt-menu-label" data-v-0e8a8aa1>Appearance</p><div class="vt-menu-action action" data-v-0e8a8aa1><button class="vt-switch vt-switch-appearance" type="button" role="switch" aria-label="Toggle dark mode" data-v-0e8a8aa1><span class="vt-switch-check"><span class="vt-switch-icon"><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-sun"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-moon"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="vt-menu-group" data-v-0e8a8aa1><div class="vt-menu-item item" data-v-0e8a8aa1><div class="vt-social-links social-links" data-v-0e8a8aa1><!--[--><a class="vt-social-link is-small" href="https://github.com/mogland" title="github" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-social-link-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden">github</span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><button type="button" class="vt-hamburger VPNavBarHamburger hamburger" aria-label="Mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-e46bbdf7 data-v-5f1b69af><span class="vt-hamburger-container"><span class="vt-hamburger-top"></span><span class="vt-hamburger-middle"></span><span class="vt-hamburger-bottom"></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-732aa6ea data-v-4389294b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-4389294b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-4389294b><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-4389294b>Menu</span></button><a class="top-link" href="#" data-v-4389294b>Return to top</a></div><aside class="VPSidebar" data-v-732aa6ea data-v-1ad4d35a><nav id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-1ad4d35a><!--[--><!--]--><span id="sidebar-aria-label" class="visually-hidden" data-v-1ad4d35a>Sidebar Navigation</span><!--[--><div class="group" data-v-1ad4d35a><section class="VPSidebarGroup" data-v-1ad4d35a data-v-ba6c966b><div class="title" data-v-ba6c966b><h2 class="title-text" data-v-ba6c966b>指南</h2></div><!--[--><a class="link" href="/guide/why.html" data-v-ba6c966b data-v-ba049f72><p class="link-text" data-v-ba049f72>简介</p></a><a class="link" href="/guide/" data-v-ba6c966b data-v-ba049f72><p class="link-text" data-v-ba049f72>快速起步</p></a><a class="link" href="/guide/features.html" data-v-ba6c966b data-v-ba049f72><p class="link-text" data-v-ba049f72>主要功能</p></a><a class="link" href="/guide/compare.html" data-v-ba6c966b data-v-ba049f72><p class="link-text" data-v-ba049f72>跟其他的博客系统进行对比</p></a><!--]--></section></div><div class="group" data-v-1ad4d35a><section class="VPSidebarGroup" data-v-1ad4d35a data-v-ba6c966b><div class="title" data-v-ba6c966b><h2 class="title-text" data-v-ba6c966b>进阶安装</h2></div><!--[--><a class="link" href="/install/" data-v-ba6c966b data-v-ba049f72><p class="link-text" data-v-ba049f72>自定义配置 Mog Core</p></a><a class="link" href="/install/build.html" data-v-ba6c966b data-v-ba049f72><p class="link-text" data-v-ba049f72>自主构建</p></a><!--]--></section></div><div class="group" data-v-1ad4d35a><section class="VPSidebarGroup" data-v-1ad4d35a data-v-ba6c966b><div class="title" data-v-ba6c966b><h2 class="title-text" data-v-ba6c966b>迁移指南</h2></div><!--[--><a class="link" href="/migrate/" data-v-ba6c966b data-v-ba049f72><p class="link-text" data-v-ba049f72>升级版本</p></a><a class="link" href="/migrate/from-other.html" data-v-ba6c966b data-v-ba049f72><p class="link-text" data-v-ba049f72>从其他博客系统迁移</p></a><!--]--></section></div><div class="group" data-v-1ad4d35a><section class="VPSidebarGroup" data-v-1ad4d35a data-v-ba6c966b><div class="title" data-v-ba6c966b><h2 class="title-text" data-v-ba6c966b>配置</h2></div><!--[--><a class="link" href="/config/" data-v-ba6c966b data-v-ba049f72><p class="link-text" data-v-ba049f72>配置索引</p></a><!--]--></section></div><div class="group" data-v-1ad4d35a><section class="VPSidebarGroup" data-v-1ad4d35a data-v-ba6c966b><div class="title" data-v-ba6c966b><h2 class="active title-text" data-v-ba6c966b>开发者</h2></div><!--[--><a class="link active" href="/developer/extend-service.html" data-v-ba6c966b data-v-ba049f72><p class="link-text" data-v-ba049f72>拓展新的服务模块</p></a><!--]--></section></div><!--]--><!--[--><!--]--></nav></aside><div id="VPContent" class="VPContent has-sidebar" data-v-732aa6ea data-v-48ba9850><div class="VPContentDoc has-aside has-sidebar" data-v-48ba9850 data-v-09373ad3><div class="container" data-v-09373ad3><div class="aside" data-v-09373ad3><div class="aside-container" data-v-09373ad3><!--[--><!--]--><div class="VPContentDocOutline" data-v-09373ad3 data-v-4d100ff7><div class="outline-marker" data-v-4d100ff7></div><div class="outline-title" data-v-4d100ff7>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-4d100ff7><span id="doc-outline-aria-label" class="visually-hidden" data-v-4d100ff7>Table of Contents for current page</span><ul class="root" data-v-4d100ff7><!--[--><li style="" data-v-4d100ff7><a class="outline-link" href="#创建一个微服务模块" data-v-4d100ff7>创建一个微服务模块</a><!----></li><li style="" data-v-4d100ff7><a class="outline-link" href="#使用微服务订阅事件" data-v-4d100ff7>使用微服务订阅事件</a><!----></li><li style="" data-v-4d100ff7><a class="outline-link" href="#在网关层订阅事件" data-v-4d100ff7>在网关层订阅事件</a><!----></li><li style="" data-v-4d100ff7><a class="outline-link" href="#当收到请求时-事件发生了什么变化" data-v-4d100ff7>当收到请求时，事件发生了什么变化</a><!----></li><li style="" data-v-4d100ff7><a class="outline-link" href="#快速使用-nodejs-启动一个微服务" data-v-4d100ff7>快速使用 NodeJS 启动一个微服务</a><!----></li><li style="" data-v-4d100ff7><a class="outline-link" href="#注意事项" data-v-4d100ff7>注意事项</a><!----></li><!--]--></ul></nav></div><!--[--><!--]--><!----><!--[--><!--]--></div></div><div class="content" data-v-09373ad3><!--[--><!--]--><main data-v-09373ad3><div style="position:relative;" class="vt-doc developer" data-v-09373ad3><div><h1 id="拓展新的服务模块" tabindex="-1">拓展新的服务模块 <a class="header-anchor" href="#拓展新的服务模块" aria-hidden="true">#</a></h1><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>此文章仅考虑的是 NestJS Gateway 场景下，对于其他情况暂时不做解释，按理来说应该你也能理解。</p><p>此外，这篇文章使用的是 Redis 作为传输层，你需要知道基本操作才能来看此文章，并且此文章仅讲述交互原理。</p><hr><p>文章来自 <a href="https://blog.iucky.cn/posts/programming/use-nestjs-microservice-with-other-tech" target="_blank" rel="noreferrer">可愛い松 | NestJS 微服务通过订阅发布事件与其他技术栈交互</a></p></div><p>如果你开发了一个微服务且想要让网关层来通用支持订阅事件，欢迎你来到 <a href="https://github.com/mogland/core/issues" target="_blank" rel="noreferrer">mogland/core issues</a> 提交你的服务，我们将会考虑将您的服务置入官方支持中。</p><h2 id="创建一个微服务模块" tabindex="-1">创建一个微服务模块 <a class="header-anchor" href="#创建一个微服务模块" aria-hidden="true">#</a></h2><p>使用 <code>nest g app tester</code> NestJS CLI 将会自动帮你创建对应的模块，但是你需要自己修改部分内容，比如在 main.ts，你需要将 <code>create</code> 替换为 <code>createMicroservice</code>，还有其他的，但是需要注意的是，请将 transporter 设置为 REDIS</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">app</span><span style="color:#CB7676;"> = </span><span style="color:#4D9375;">await</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">NestFactory</span><span style="color:#666666;">.</span><span style="color:#80A665;">createMicroservice</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">MicroserviceOptions</span><span style="color:#666666;">&gt;(</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#BD976A;">YourModule</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#B8A965;">transport</span><span style="color:#666666;">: </span><span style="color:#BD976A;">Transport</span><span style="color:#666666;">.</span><span style="color:#BD976A;">REDIS</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#B8A965;">options</span><span style="color:#666666;">: {</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#B8A965;">port</span><span style="color:#666666;">: </span><span style="color:#BD976A;">REDIS</span><span style="color:#666666;">.</span><span style="color:#BD976A;">port</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#B8A965;">host</span><span style="color:#666666;">: </span><span style="color:#BD976A;">REDIS</span><span style="color:#666666;">.</span><span style="color:#BD976A;">host</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#B8A965;">password</span><span style="color:#666666;">: </span><span style="color:#BD976A;">REDIS</span><span style="color:#666666;">.</span><span style="color:#BD976A;">password</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#B8A965;">username</span><span style="color:#666666;">: </span><span style="color:#BD976A;">REDIS</span><span style="color:#666666;">.</span><span style="color:#BD976A;">user</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">      },</span></span>
<span class="line"><span style="color:#666666;">    },</span><span style="color:#BD976A;">Ï</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#4D9375;">await</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">app</span><span style="color:#666666;">.</span><span style="color:#80A665;">listen</span><span style="color:#666666;">();</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">app</span><span style="color:#AB5959;"> = </span><span style="color:#1E754F;">await</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">NestFactory</span><span style="color:#999999;">.</span><span style="color:#59873A;">createMicroservice</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">MicroserviceOptions</span><span style="color:#999999;">&gt;(</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#B07D48;">YourModule</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#998418;">transport</span><span style="color:#999999;">: </span><span style="color:#B07D48;">Transport</span><span style="color:#999999;">.</span><span style="color:#B07D48;">REDIS</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#998418;">options</span><span style="color:#999999;">: {</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#998418;">port</span><span style="color:#999999;">: </span><span style="color:#B07D48;">REDIS</span><span style="color:#999999;">.</span><span style="color:#B07D48;">port</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#998418;">host</span><span style="color:#999999;">: </span><span style="color:#B07D48;">REDIS</span><span style="color:#999999;">.</span><span style="color:#B07D48;">host</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#998418;">password</span><span style="color:#999999;">: </span><span style="color:#B07D48;">REDIS</span><span style="color:#999999;">.</span><span style="color:#B07D48;">password</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#998418;">username</span><span style="color:#999999;">: </span><span style="color:#B07D48;">REDIS</span><span style="color:#999999;">.</span><span style="color:#B07D48;">user</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">      },</span></span>
<span class="line"><span style="color:#999999;">    },</span><span style="color:#B07D48;">Ï</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#1E754F;">await</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">app</span><span style="color:#999999;">.</span><span style="color:#59873A;">listen</span><span style="color:#999999;">();</span></span>
<span class="line"></span></code></pre></div><p>接下来我们使用 redis-cli 来监控事件变化</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">redis</span><span style="color:#CB7676;">-</span><span style="color:#BD976A;">cli</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">monitor</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">redis</span><span style="color:#AB5959;">-</span><span style="color:#B07D48;">cli</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">monitor</span></span>
<span class="line"></span></code></pre></div><h2 id="使用微服务订阅事件" tabindex="-1">使用微服务订阅事件 <a class="header-anchor" href="#使用微服务订阅事件" aria-hidden="true">#</a></h2><p>与 <code>@nestjs/common</code> 中不一样的 <code>@Get()</code>，你需要使用在 microservices 包内的 MessagePattern，以下是一个示范</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#666666;">@</span><span style="color:#80A665;">MessagePattern</span><span style="color:#666666;">({ </span><span style="color:#B8A965;">cmd</span><span style="color:#666666;">: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">get.something</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;"> })</span></span>
<span class="line"><span style="color:#BD976A;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getSomething</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">getSomething</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#999999;">@</span><span style="color:#59873A;">MessagePattern</span><span style="color:#999999;">({ </span><span style="color:#998418;">cmd</span><span style="color:#999999;">: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">get.something</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;"> })</span></span>
<span class="line"><span style="color:#B07D48;">async</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getSomething</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">getSomething</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>接下来，启动这个微服务，注意一下上方 redis-cli monitor 出现的日志</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4C9A91;">1673269961.656461</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> 127.0.0.1:</span><span style="color:#4C9A91;">63956</span><span style="color:#666666;">]</span><span style="color:#C98A7DAA;"> &quot;</span><span style="color:#C98A7D;">info</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"><span style="color:#4C9A91;">1673269961.657177</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> 127.0.0.1:</span><span style="color:#4C9A91;">63957</span><span style="color:#666666;">]</span><span style="color:#C98A7DAA;"> &quot;</span><span style="color:#C98A7D;">info</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"><span style="color:#4C9A91;">1673269961.659145</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> 127.0.0.1:</span><span style="color:#4C9A91;">63956</span><span style="color:#666666;">]</span><span style="color:#C98A7DAA;"> &quot;</span><span style="color:#C98A7D;">subscribe</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;"> {</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">get.something</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#2F798A;">1673269961.656461</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> 127.0.0.1:</span><span style="color:#2F798A;">63956</span><span style="color:#999999;">]</span><span style="color:#B56959AA;"> &quot;</span><span style="color:#B56959;">info</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"><span style="color:#2F798A;">1673269961.657177</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> 127.0.0.1:</span><span style="color:#2F798A;">63957</span><span style="color:#999999;">]</span><span style="color:#B56959AA;"> &quot;</span><span style="color:#B56959;">info</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"><span style="color:#2F798A;">1673269961.659145</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> 127.0.0.1:</span><span style="color:#2F798A;">63956</span><span style="color:#999999;">]</span><span style="color:#B56959AA;"> &quot;</span><span style="color:#B56959;">subscribe</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;"> {</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">get.something</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}</span></span>
<span class="line"></span></code></pre></div><p>看样子我们找到了一个开始订阅的事件，让我们记住这一个事件，继续下去。</p><blockquote><p>后续，我将使用 <code>user.get.master</code> 来代替 <code>get.something</code> 事件</p><p>另外，这种事件命名方式并不是必须的，这只是我个人习惯</p></blockquote><h2 id="在网关层订阅事件" tabindex="-1">在网关层订阅事件 <a class="header-anchor" href="#在网关层订阅事件" aria-hidden="true">#</a></h2><p>你需要在网关层模块中导入一个 <code>ClientModule</code>：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#BD976A;">ClientsModule</span><span style="color:#666666;">.</span><span style="color:#80A665;">register</span><span style="color:#666666;">([</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#B8A965;">name</span><span style="color:#666666;">: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">YOUR_MODULE</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#B8A965;">transport</span><span style="color:#666666;">: </span><span style="color:#BD976A;">Transport</span><span style="color:#666666;">.</span><span style="color:#BD976A;">REDIS</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#B8A965;">options</span><span style="color:#666666;">: {</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#B8A965;">port</span><span style="color:#666666;">: </span><span style="color:#BD976A;">REDIS</span><span style="color:#666666;">.</span><span style="color:#BD976A;">port</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#B8A965;">host</span><span style="color:#666666;">: </span><span style="color:#BD976A;">REDIS</span><span style="color:#666666;">.</span><span style="color:#BD976A;">host</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#B8A965;">password</span><span style="color:#666666;">: </span><span style="color:#BD976A;">REDIS</span><span style="color:#666666;">.</span><span style="color:#BD976A;">password</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#B8A965;">username</span><span style="color:#666666;">: </span><span style="color:#BD976A;">REDIS</span><span style="color:#666666;">.</span><span style="color:#BD976A;">user</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        },</span></span>
<span class="line"><span style="color:#666666;">      },</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">]),</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B07D48;">ClientsModule</span><span style="color:#999999;">.</span><span style="color:#59873A;">register</span><span style="color:#999999;">([</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#998418;">name</span><span style="color:#999999;">: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">YOUR_MODULE</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#998418;">transport</span><span style="color:#999999;">: </span><span style="color:#B07D48;">Transport</span><span style="color:#999999;">.</span><span style="color:#B07D48;">REDIS</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#998418;">options</span><span style="color:#999999;">: {</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#998418;">port</span><span style="color:#999999;">: </span><span style="color:#B07D48;">REDIS</span><span style="color:#999999;">.</span><span style="color:#B07D48;">port</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#998418;">host</span><span style="color:#999999;">: </span><span style="color:#B07D48;">REDIS</span><span style="color:#999999;">.</span><span style="color:#B07D48;">host</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#998418;">password</span><span style="color:#999999;">: </span><span style="color:#B07D48;">REDIS</span><span style="color:#999999;">.</span><span style="color:#B07D48;">password</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#998418;">username</span><span style="color:#999999;">: </span><span style="color:#B07D48;">REDIS</span><span style="color:#999999;">.</span><span style="color:#B07D48;">user</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        },</span></span>
<span class="line"><span style="color:#999999;">      },</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">]),</span></span>
<span class="line"></span></code></pre></div><p>之后在 controller 构造函数中注入它，再任意搞一个请求：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#80A665;">constructor</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    @</span><span style="color:#80A665;">Inject</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">YOUR_MODULE</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">private</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">readonly</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">yourModule</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">ClientProxy</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">@</span><span style="color:#80A665;">Get</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">/</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getMaster</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">category</span><span style="color:#666666;">.</span><span style="color:#80A665;">send</span><span style="color:#666666;">({ </span><span style="color:#B8A965;">cmd</span><span style="color:#666666;">: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;"> },</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{})</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">constructor</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    @</span><span style="color:#59873A;">Inject</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">YOUR_MODULE</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">private</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">readonly</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">yourModule</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">ClientProxy</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">@</span><span style="color:#59873A;">Get</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">/</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">async</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getMaster</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">category</span><span style="color:#999999;">.</span><span style="color:#59873A;">send</span><span style="color:#999999;">({ </span><span style="color:#998418;">cmd</span><span style="color:#999999;">: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;"> },</span><span style="color:#393A34;"> </span><span style="color:#999999;">{})</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>让我们继续启动网关层，redis-cli monitor 此时不会出现任何日志，这是正常的</p><h2 id="当收到请求时-事件发生了什么变化" tabindex="-1">当收到请求时，事件发生了什么变化 <a class="header-anchor" href="#当收到请求时-事件发生了什么变化" aria-hidden="true">#</a></h2><p>我们访问一下网关层中配置的路径，注意一下 redis-cli monitor 出现的日志：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4C9A91;">1673270738.710378</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> 127.0.0.1:</span><span style="color:#4C9A91;">64424</span><span style="color:#666666;">]</span><span style="color:#C98A7DAA;"> &quot;</span><span style="color:#C98A7D;">subscribe</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}.reply</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"><span style="color:#4C9A91;">1673270738.710744</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> 127.0.0.1:</span><span style="color:#4C9A91;">64425</span><span style="color:#666666;">]</span><span style="color:#C98A7DAA;"> &quot;</span><span style="color:#C98A7D;">publish</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">pattern</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">},</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">data</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:{},</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">id</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">6c1475df-b357-4bc9-8443-5f0f06bf8e0b</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"><span style="color:#4C9A91;">1673270738.781133</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> 127.0.0.1:</span><span style="color:#4C9A91;">64931</span><span style="color:#666666;">]</span><span style="color:#C98A7DAA;"> &quot;</span><span style="color:#C98A7D;">publish</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}.reply</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">response</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">_id</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">638c311569199e8250503d80</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">username</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">wibus-wee</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">nickname</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">Wibus</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">description</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">\xe6\x88\x91\xe6\x98\xaf\xe7\xbb\x83\xe4\xb9\xa0\xe6\x97\xb6\xe9\x95\xbf\xe4\xb8\xa4\xe5\xb9\xb4\xe5\x8d\x8a\xe7\x9a\x84\xe4\xb8\xaa\xe4\xba\xba\xe7\xbb\x83\xe4\xb9\xa0\xe7\x94\x9f</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">avatar</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">http://example.com</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">email</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">example@example.com</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">url</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">http://example.com</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">role</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:0,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">created</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">2022-12-04T05:33:09.526Z</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">__v</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:0,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">lastLoginTime</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">2023-01-09T08:39:39.723Z</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">id</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">638c311569199e8250503d80</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">},</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">isDisposed</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:true,</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">id</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">da1d3910-5e1b-4193-8637-9cbfdd8ebac1</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"><span style="color:#4C9A91;">1673270738.714335</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> 127.0.0.1:</span><span style="color:#4C9A91;">64424</span><span style="color:#666666;">]</span><span style="color:#C98A7DAA;"> &quot;</span><span style="color:#C98A7D;">unsubscribe</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}.reply</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#2F798A;">1673270738.710378</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> 127.0.0.1:</span><span style="color:#2F798A;">64424</span><span style="color:#999999;">]</span><span style="color:#B56959AA;"> &quot;</span><span style="color:#B56959;">subscribe</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}.reply</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"><span style="color:#2F798A;">1673270738.710744</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> 127.0.0.1:</span><span style="color:#2F798A;">64425</span><span style="color:#999999;">]</span><span style="color:#B56959AA;"> &quot;</span><span style="color:#B56959;">publish</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">pattern</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">},</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">data</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:{},</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">id</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">6c1475df-b357-4bc9-8443-5f0f06bf8e0b</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"><span style="color:#2F798A;">1673270738.781133</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> 127.0.0.1:</span><span style="color:#2F798A;">64931</span><span style="color:#999999;">]</span><span style="color:#B56959AA;"> &quot;</span><span style="color:#B56959;">publish</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}.reply</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">response</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">_id</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">638c311569199e8250503d80</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">username</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">wibus-wee</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">nickname</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">Wibus</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">description</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">\xe6\x88\x91\xe6\x98\xaf\xe7\xbb\x83\xe4\xb9\xa0\xe6\x97\xb6\xe9\x95\xbf\xe4\xb8\xa4\xe5\xb9\xb4\xe5\x8d\x8a\xe7\x9a\x84\xe4\xb8\xaa\xe4\xba\xba\xe7\xbb\x83\xe4\xb9\xa0\xe7\x94\x9f</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">avatar</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">http://example.com</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">email</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">example@example.com</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">url</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">http://example.com</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">role</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:0,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">created</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">2022-12-04T05:33:09.526Z</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">__v</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:0,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">lastLoginTime</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">2023-01-09T08:39:39.723Z</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">id</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">638c311569199e8250503d80</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">},</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">isDisposed</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:true,</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">id</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">da1d3910-5e1b-4193-8637-9cbfdd8ebac1</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"><span style="color:#2F798A;">1673270738.714335</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> 127.0.0.1:</span><span style="color:#2F798A;">64424</span><span style="color:#999999;">]</span><span style="color:#B56959AA;"> &quot;</span><span style="color:#B56959;">unsubscribe</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}.reply</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>这日志有点辣眼睛，而且这个是我们开了网关层 &amp; 微服务出现的日志，我们暂时只想知道网关层，我们将上面的微服务关掉，再访问一次：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4C9A91;">1673270936.835823</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> 127.0.0.1:</span><span style="color:#4C9A91;">64424</span><span style="color:#666666;">]</span><span style="color:#C98A7DAA;"> &quot;</span><span style="color:#C98A7D;">subscribe</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}.reply</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"><span style="color:#4C9A91;">1673270936.836329</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> 127.0.0.1:</span><span style="color:#4C9A91;">64425</span><span style="color:#666666;">]</span><span style="color:#C98A7DAA;"> &quot;</span><span style="color:#C98A7D;">publish</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">pattern</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">},</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">data</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:{},</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">id</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">f118b8f7-26ce-44dc-b8b0-592fceab1250</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"><span style="color:#4C9A91;">1673270939.835447</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> 127.0.0.1:</span><span style="color:#4C9A91;">64424</span><span style="color:#666666;">]</span><span style="color:#C98A7DAA;"> &quot;</span><span style="color:#C98A7D;">unsubscribe</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}.reply</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#2F798A;">1673270936.835823</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> 127.0.0.1:</span><span style="color:#2F798A;">64424</span><span style="color:#999999;">]</span><span style="color:#B56959AA;"> &quot;</span><span style="color:#B56959;">subscribe</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}.reply</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"><span style="color:#2F798A;">1673270936.836329</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> 127.0.0.1:</span><span style="color:#2F798A;">64425</span><span style="color:#999999;">]</span><span style="color:#B56959AA;"> &quot;</span><span style="color:#B56959;">publish</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">pattern</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">},</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">data</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:{},</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">id</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">f118b8f7-26ce-44dc-b8b0-592fceab1250</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"><span style="color:#2F798A;">1673270939.835447</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> 127.0.0.1:</span><span style="color:#2F798A;">64424</span><span style="color:#999999;">]</span><span style="color:#B56959AA;"> &quot;</span><span style="color:#B56959;">unsubscribe</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}.reply</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>我们精简一下，将无用的数据去掉，只留下我们想要的东西吧：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">subscribe</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">cmd.reply</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">publish</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">pattern</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">cmd</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">},</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">data</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:{},</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">id</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">6c1475df-b357-4bc9-8443-5f0f06bf8e0b</span><span style="color:#C99076;">\&quot;</span><span style="color:#C98A7D;">}</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">unsubscribe</span><span style="color:#C98A7DAA;">&quot; &quot;</span><span style="color:#C98A7D;">cmd.reply</span><span style="color:#C98A7DAA;">&quot;</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">subscribe</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">cmd.reply</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">publish</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">cmd</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">pattern</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">cmd</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">},</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">data</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:{},</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">id</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">6c1475df-b357-4bc9-8443-5f0f06bf8e0b</span><span style="color:#A65E2B;">\&quot;</span><span style="color:#B56959;">}</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">unsubscribe</span><span style="color:#B56959AA;">&quot; &quot;</span><span style="color:#B56959;">cmd.reply</span><span style="color:#B56959AA;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>可以看到网关层先订阅了一个基于之前我们定义的 <code>user.get.master</code> 的 reply 事件，之后，在 <code>user.get.master</code> 事件上发布了数据，就是将 pattern, data, id 发布了，十分重要的就是这个id，这是网关层中传输来的。</p><p>对比一下，你就可以知道其中有一个特别长的日志就是由微服务发布的，可以发现微服务是向 reply 事件发布了事件，内容还包含了之前我们提到的 id，之后网关层收到了数据返回，接着返回来自微服务的数据，取消订阅对应的事件</p><p>让我们用一个图来解释下吧：</p><div class="language-mermaid"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">graph</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">TD</span><span style="color:#DBD7CAEE;">;</span></span>
<span class="line"><span style="color:#BD976A;">A</span><span style="color:#4D9375;">[</span><span style="color:#C98A7D;">网关层接受请求</span><span style="color:#4D9375;">]</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">--&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">B</span><span style="color:#4D9375;">[</span><span style="color:#C98A7D;">开始订阅 event.reply 事件</span><span style="color:#4D9375;">]</span></span>
<span class="line"><span style="color:#BD976A;">A </span><span style="color:#4D9375;">--&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">C</span><span style="color:#4D9375;">[</span><span style="color:#C98A7D;">向 event 发布 data 和 id</span><span style="color:#4D9375;">]</span></span>
<span class="line"><span style="color:#BD976A;">C </span><span style="color:#4D9375;">--&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">D</span></span>
<span class="line"><span style="color:#BD976A;">B </span><span style="color:#4D9375;">--&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">F</span></span>
<span class="line"><span style="color:#BD976A;">E </span><span style="color:#4D9375;">--&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">F</span><span style="color:#4D9375;">[</span><span style="color:#C98A7D;">网关层收到来自 event.reply 的数据</span><span style="color:#4D9375;">]</span></span>
<span class="line"><span style="color:#BD976A;">F </span><span style="color:#4D9375;">--&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">G</span><span style="color:#4D9375;">[</span><span style="color:#C98A7D;">取消订阅 event.reply 事件</span><span style="color:#4D9375;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">AA</span><span style="color:#4D9375;">[</span><span style="color:#C98A7D;">微服务开始订阅 event 事件</span><span style="color:#4D9375;">]</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">--&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">D</span><span style="color:#4D9375;">[</span><span style="color:#C98A7D;">微服务收到来自 event 的数据</span><span style="color:#4D9375;">]</span></span>
<span class="line"><span style="color:#BD976A;">D </span><span style="color:#4D9375;">--&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">E</span><span style="color:#4D9375;">[</span><span style="color:#C98A7D;">向 event.reply 发布数据</span><span style="color:#4D9375;">]</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">graph</span><span style="color:#393A34;"> </span><span style="color:#59873A;">TD</span><span style="color:#393A34;">;</span></span>
<span class="line"><span style="color:#B07D48;">A</span><span style="color:#1E754F;">[</span><span style="color:#B56959;">网关层接受请求</span><span style="color:#1E754F;">]</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">--&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">B</span><span style="color:#1E754F;">[</span><span style="color:#B56959;">开始订阅 event.reply 事件</span><span style="color:#1E754F;">]</span></span>
<span class="line"><span style="color:#B07D48;">A </span><span style="color:#1E754F;">--&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">C</span><span style="color:#1E754F;">[</span><span style="color:#B56959;">向 event 发布 data 和 id</span><span style="color:#1E754F;">]</span></span>
<span class="line"><span style="color:#B07D48;">C </span><span style="color:#1E754F;">--&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">D</span></span>
<span class="line"><span style="color:#B07D48;">B </span><span style="color:#1E754F;">--&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">F</span></span>
<span class="line"><span style="color:#B07D48;">E </span><span style="color:#1E754F;">--&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">F</span><span style="color:#1E754F;">[</span><span style="color:#B56959;">网关层收到来自 event.reply 的数据</span><span style="color:#1E754F;">]</span></span>
<span class="line"><span style="color:#B07D48;">F </span><span style="color:#1E754F;">--&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">G</span><span style="color:#1E754F;">[</span><span style="color:#B56959;">取消订阅 event.reply 事件</span><span style="color:#1E754F;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">AA</span><span style="color:#1E754F;">[</span><span style="color:#B56959;">微服务开始订阅 event 事件</span><span style="color:#1E754F;">]</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">--&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">D</span><span style="color:#1E754F;">[</span><span style="color:#B56959;">微服务收到来自 event 的数据</span><span style="color:#1E754F;">]</span></span>
<span class="line"><span style="color:#B07D48;">D </span><span style="color:#1E754F;">--&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">E</span><span style="color:#1E754F;">[</span><span style="color:#B56959;">向 event.reply 发布数据</span><span style="color:#1E754F;">]</span></span>
<span class="line"></span></code></pre></div><p>总结一下，其实就是这样的：</p><p><img src="https://cdn.my-api.cn/user/w/asset-pic-picgo/2023-01-202301092137599.png" alt="SCR-20230109-nrl"></p><h2 id="快速使用-nodejs-启动一个微服务" tabindex="-1">快速使用 NodeJS 启动一个微服务 <a class="header-anchor" href="#快速使用-nodejs-启动一个微服务" aria-hidden="true">#</a></h2><p>使用 pnpm 安装上 redis，根据上方我所说的内容，抽出来一些功能函数，以提高可维护性。</p><p>因为 <a href="https://docs.nestjs.com/microservices/basics" target="_blank" rel="noreferrer">NestJS 文档</a> 有说到两种模式，分别是 <code>message</code> 和 <code>event</code>，因此我们需要做一个判定和快捷生成对应的 pattern：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * isEmitter 判断是否为 event-based 模式</span></span>
<span class="line"><span style="color:#758575DD;"> * </span></span>
<span class="line"><span style="color:#758575DD;"> * 通过 JSON.stringify 判断是否为 event-based 模式。</span></span>
<span class="line"><span style="color:#758575DD;"> * 原理：在 event-based 模式下, pattern 是不带 cmd 的。</span></span>
<span class="line"><span style="color:#758575DD;"> *</span></span>
<span class="line"><span style="color:#758575DD;"> * PS：`isEmitter` 方法可能在这个案例里面没有用，但不排除有其他需求时是有用的</span></span>
<span class="line"><span style="color:#758575DD;"> * </span></span>
<span class="line"><span style="color:#758575DD;"> * </span><span style="color:#666666;">@</span><span style="color:#4D9375;">param</span><span style="color:#758575DD;"> </span><span style="color:#666666;">{</span><span style="color:#5DA9A7;">string</span><span style="color:#666666;">}</span><span style="color:#758575DD;"> </span><span style="color:#BD976A;">pattern</span><span style="color:#758575DD;"> 模式</span></span>
<span class="line"><span style="color:#758575DD;"> * </span><span style="color:#666666;">@</span><span style="color:#4D9375;">returns</span><span style="color:#758575DD;"> boolean</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">isEmitter</span><span style="color:#666666;">(</span><span style="color:#BD976A;">pattern</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">try</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">JSON</span><span style="color:#666666;">.</span><span style="color:#80A665;">stringify</span><span style="color:#666666;">(</span><span style="color:#BD976A;">pattern</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">catch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * 快捷生成模式</span></span>
<span class="line"><span style="color:#758575DD;"> * </span><span style="color:#666666;">@</span><span style="color:#4D9375;">param</span><span style="color:#758575DD;"> </span><span style="color:#666666;">{</span><span style="color:#5DA9A7;">string</span><span style="color:#666666;">}</span><span style="color:#758575DD;"> </span><span style="color:#BD976A;">pattern</span><span style="color:#758575DD;"> 活动名称</span></span>
<span class="line"><span style="color:#758575DD;"> * </span><span style="color:#666666;">@</span><span style="color:#4D9375;">param</span><span style="color:#758575DD;"> </span><span style="color:#666666;">{</span><span style="color:#5DA9A7;">boolean</span><span style="color:#666666;">}</span><span style="color:#758575DD;"> </span><span style="color:#BD976A;">isEmit</span><span style="color:#758575DD;"> 是否为 event-based 模式</span></span>
<span class="line"><span style="color:#758575DD;"> * </span><span style="color:#666666;">@</span><span style="color:#4D9375;">returns</span><span style="color:#758575DD;"> string</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">generagtePattern</span><span style="color:#666666;">(</span><span style="color:#BD976A;">pattern</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">isEmit</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">!</span><span style="color:#BD976A;">isEmit</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">JSON</span><span style="color:#666666;">.</span><span style="color:#80A665;">stringify</span><span style="color:#666666;">({ </span><span style="color:#B8A965;">cmd</span><span style="color:#666666;">: </span><span style="color:#BD976A;">pattern</span><span style="color:#666666;"> })</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">pattern</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * isEmitter 判断是否为 event-based 模式</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span></span>
<span class="line"><span style="color:#A0ADA0;"> * 通过 JSON.stringify 判断是否为 event-based 模式。</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 原理：在 event-based 模式下, pattern 是不带 cmd 的。</span></span>
<span class="line"><span style="color:#A0ADA0;"> *</span></span>
<span class="line"><span style="color:#A0ADA0;"> * PS：`isEmitter` 方法可能在这个案例里面没有用，但不排除有其他需求时是有用的</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span><span style="color:#999999;">@</span><span style="color:#1E754F;">param</span><span style="color:#A0ADA0;"> </span><span style="color:#999999;">{</span><span style="color:#2E808F;">string</span><span style="color:#999999;">}</span><span style="color:#A0ADA0;"> </span><span style="color:#B07D48;">pattern</span><span style="color:#A0ADA0;"> 模式</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span><span style="color:#999999;">@</span><span style="color:#1E754F;">returns</span><span style="color:#A0ADA0;"> boolean</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">isEmitter</span><span style="color:#999999;">(</span><span style="color:#B07D48;">pattern</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">try</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">JSON</span><span style="color:#999999;">.</span><span style="color:#59873A;">stringify</span><span style="color:#999999;">(</span><span style="color:#B07D48;">pattern</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">catch</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 快捷生成模式</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span><span style="color:#999999;">@</span><span style="color:#1E754F;">param</span><span style="color:#A0ADA0;"> </span><span style="color:#999999;">{</span><span style="color:#2E808F;">string</span><span style="color:#999999;">}</span><span style="color:#A0ADA0;"> </span><span style="color:#B07D48;">pattern</span><span style="color:#A0ADA0;"> 活动名称</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span><span style="color:#999999;">@</span><span style="color:#1E754F;">param</span><span style="color:#A0ADA0;"> </span><span style="color:#999999;">{</span><span style="color:#2E808F;">boolean</span><span style="color:#999999;">}</span><span style="color:#A0ADA0;"> </span><span style="color:#B07D48;">isEmit</span><span style="color:#A0ADA0;"> 是否为 event-based 模式</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span><span style="color:#999999;">@</span><span style="color:#1E754F;">returns</span><span style="color:#A0ADA0;"> string</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">generagtePattern</span><span style="color:#999999;">(</span><span style="color:#B07D48;">pattern</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">isEmit</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">!</span><span style="color:#B07D48;">isEmit</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">JSON</span><span style="color:#999999;">.</span><span style="color:#59873A;">stringify</span><span style="color:#999999;">({ </span><span style="color:#998418;">cmd</span><span style="color:#999999;">: </span><span style="color:#B07D48;">pattern</span><span style="color:#999999;"> })</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">pattern</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>我们分析一下信息的结构吧，很明显来自Gateway的信息带有3个key：pattern, data, id，其中 id 是自动生成的，也是返回响应时必要的；</p><p>再分析一下NestJS Microservice 是怎么响应的，它的信息也带有3个key：response, isDispose, id，其中 isDispose 必须为 true，id 必须是来自 Gateway 的。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * 解析来自 NestJS Gateway 发布的信息</span></span>
<span class="line"><span style="color:#758575DD;"> * </span><span style="color:#666666;">@</span><span style="color:#4D9375;">param</span><span style="color:#758575DD;"> </span><span style="color:#666666;">{</span><span style="color:#5DA9A7;">string</span><span style="color:#666666;">}</span><span style="color:#758575DD;"> </span><span style="color:#BD976A;">message</span></span>
<span class="line"><span style="color:#758575DD;"> * </span><span style="color:#666666;">@</span><span style="color:#4D9375;">returns</span><span style="color:#758575DD;"> object</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">parseEventDataFromGateway</span><span style="color:#666666;">(</span><span style="color:#BD976A;">message</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">message</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">JSON</span><span style="color:#666666;">.</span><span style="color:#80A665;">parse</span><span style="color:#666666;">(</span><span style="color:#BD976A;">message</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#B8A965;">id</span><span style="color:#666666;">: </span><span style="color:#BD976A;">message</span><span style="color:#666666;">.</span><span style="color:#BD976A;">id</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#B8A965;">data</span><span style="color:#666666;">: </span><span style="color:#BD976A;">message</span><span style="color:#666666;">.</span><span style="color:#BD976A;">data</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#B8A965;">pattern</span><span style="color:#666666;">: </span><span style="color:#BD976A;">JSON</span><span style="color:#666666;">.</span><span style="color:#80A665;">stringify</span><span style="color:#666666;">(</span><span style="color:#BD976A;">message</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pattern</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#B8A965;">isEmitter</span><span style="color:#666666;">: </span><span style="color:#80A665;">isEmitter</span><span style="color:#666666;">(</span><span style="color:#BD976A;">message</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pattern</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#666666;">  }</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * 生成响应数据</span></span>
<span class="line"><span style="color:#758575DD;"> * </span><span style="color:#666666;">@</span><span style="color:#4D9375;">param</span><span style="color:#758575DD;"> </span><span style="color:#666666;">{</span><span style="color:#5DA9A7;">string</span><span style="color:#666666;">}</span><span style="color:#758575DD;"> </span><span style="color:#BD976A;">id</span><span style="color:#758575DD;"> 事件ID</span></span>
<span class="line"><span style="color:#758575DD;"> * </span><span style="color:#666666;">@</span><span style="color:#4D9375;">param</span><span style="color:#758575DD;"> </span><span style="color:#666666;">{</span><span style="color:#5DA9A7;">string | object</span><span style="color:#666666;">}</span><span style="color:#758575DD;"> </span><span style="color:#BD976A;">data</span><span style="color:#758575DD;"> 事件数据</span></span>
<span class="line"><span style="color:#758575DD;"> * </span><span style="color:#666666;">@</span><span style="color:#4D9375;">returns</span><span style="color:#758575DD;"> string</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">generagteResponse</span><span style="color:#666666;">(</span><span style="color:#BD976A;">id</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">data</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">JSON</span><span style="color:#666666;">.</span><span style="color:#80A665;">stringify</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#B8A965;">response</span><span style="color:#666666;">: </span><span style="color:#BD976A;">data</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#B8A965;">isDisposed</span><span style="color:#666666;">: </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#BD976A;">id</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    }</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 解析来自 NestJS Gateway 发布的信息</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span><span style="color:#999999;">@</span><span style="color:#1E754F;">param</span><span style="color:#A0ADA0;"> </span><span style="color:#999999;">{</span><span style="color:#2E808F;">string</span><span style="color:#999999;">}</span><span style="color:#A0ADA0;"> </span><span style="color:#B07D48;">message</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span><span style="color:#999999;">@</span><span style="color:#1E754F;">returns</span><span style="color:#A0ADA0;"> object</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">parseEventDataFromGateway</span><span style="color:#999999;">(</span><span style="color:#B07D48;">message</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">message</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">JSON</span><span style="color:#999999;">.</span><span style="color:#59873A;">parse</span><span style="color:#999999;">(</span><span style="color:#B07D48;">message</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#998418;">id</span><span style="color:#999999;">: </span><span style="color:#B07D48;">message</span><span style="color:#999999;">.</span><span style="color:#B07D48;">id</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#998418;">data</span><span style="color:#999999;">: </span><span style="color:#B07D48;">message</span><span style="color:#999999;">.</span><span style="color:#B07D48;">data</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#998418;">pattern</span><span style="color:#999999;">: </span><span style="color:#B07D48;">JSON</span><span style="color:#999999;">.</span><span style="color:#59873A;">stringify</span><span style="color:#999999;">(</span><span style="color:#B07D48;">message</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pattern</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#998418;">isEmitter</span><span style="color:#999999;">: </span><span style="color:#59873A;">isEmitter</span><span style="color:#999999;">(</span><span style="color:#B07D48;">message</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pattern</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#999999;">  }</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 生成响应数据</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span><span style="color:#999999;">@</span><span style="color:#1E754F;">param</span><span style="color:#A0ADA0;"> </span><span style="color:#999999;">{</span><span style="color:#2E808F;">string</span><span style="color:#999999;">}</span><span style="color:#A0ADA0;"> </span><span style="color:#B07D48;">id</span><span style="color:#A0ADA0;"> 事件ID</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span><span style="color:#999999;">@</span><span style="color:#1E754F;">param</span><span style="color:#A0ADA0;"> </span><span style="color:#999999;">{</span><span style="color:#2E808F;">string | object</span><span style="color:#999999;">}</span><span style="color:#A0ADA0;"> </span><span style="color:#B07D48;">data</span><span style="color:#A0ADA0;"> 事件数据</span></span>
<span class="line"><span style="color:#A0ADA0;"> * </span><span style="color:#999999;">@</span><span style="color:#1E754F;">returns</span><span style="color:#A0ADA0;"> string</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">generagteResponse</span><span style="color:#999999;">(</span><span style="color:#B07D48;">id</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">data</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">JSON</span><span style="color:#999999;">.</span><span style="color:#59873A;">stringify</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#998418;">response</span><span style="color:#999999;">: </span><span style="color:#B07D48;">data</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#998418;">isDisposed</span><span style="color:#999999;">: </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#B07D48;">id</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    }</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>所以剩下的就是创建 redis client 和发布/订阅事件了，需要注意的是，返回给 Gateway 的信息需要在事件后加上<code>.reply</code>，你在 monitor 上也能看到 Gateway 在发布事件的时候会同时订阅对应的reply事件：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">createClient</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">redis</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">client</span><span style="color:#CB7676;"> = </span><span style="color:#80A665;">createClient</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">subscriber</span><span style="color:#CB7676;"> = </span><span style="color:#BD976A;">client</span><span style="color:#666666;">.</span><span style="color:#80A665;">duplicate</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#4D9375;">await</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">subscriber</span><span style="color:#666666;">.</span><span style="color:#80A665;">connect</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">publisher</span><span style="color:#CB7676;"> = </span><span style="color:#BD976A;">client</span><span style="color:#666666;">.</span><span style="color:#80A665;">duplicate</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#4D9375;">await</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">publisher</span><span style="color:#666666;">.</span><span style="color:#80A665;">connect</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">pattern</span><span style="color:#CB7676;"> = </span><span style="color:#80A665;">generagtePattern</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">user.get.master</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">,</span><span style="color:#CB7676;"> </span><span style="color:#4D9375;">false</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">await</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">subscriber</span><span style="color:#666666;">.</span><span style="color:#80A665;">subscribe</span><span style="color:#666666;">(</span><span style="color:#BD976A;">pattern</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">message</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#666666;">{</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">id</span><span style="color:#666666;">,</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">data</span><span style="color:#666666;">,</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">pattern</span><span style="color:#666666;">,</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">isEmitter</span><span style="color:#CB7676;"> </span><span style="color:#666666;">}</span><span style="color:#CB7676;"> = </span><span style="color:#80A665;">parseEventDataFromGateway</span><span style="color:#666666;">(</span><span style="color:#BD976A;">message</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">Message: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">message</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">Event ID: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">id</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">Data: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">data</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">Pattern: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">pattern</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">isEmitter: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">isEmitter</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// ⚠️ 注意下这里，这个的 event 是 pattern.reply！</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">await</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">publisher</span><span style="color:#666666;">.</span><span style="color:#80A665;">publish</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">`</span><span style="color:#666666;">${</span><span style="color:#C98A7D;">pattern</span><span style="color:#666666;">}</span><span style="color:#C98A7D;">.reply</span><span style="color:#C98A7DAA;">`</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">generagteResponse</span><span style="color:#666666;">(</span><span style="color:#BD976A;">id</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{ </span><span style="color:#B8A965;">name</span><span style="color:#666666;">: </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">test</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;"> }))</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">createClient</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">redis</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">client</span><span style="color:#AB5959;"> = </span><span style="color:#59873A;">createClient</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">subscriber</span><span style="color:#AB5959;"> = </span><span style="color:#B07D48;">client</span><span style="color:#999999;">.</span><span style="color:#59873A;">duplicate</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#1E754F;">await</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">subscriber</span><span style="color:#999999;">.</span><span style="color:#59873A;">connect</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">publisher</span><span style="color:#AB5959;"> = </span><span style="color:#B07D48;">client</span><span style="color:#999999;">.</span><span style="color:#59873A;">duplicate</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#1E754F;">await</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">publisher</span><span style="color:#999999;">.</span><span style="color:#59873A;">connect</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">pattern</span><span style="color:#AB5959;"> = </span><span style="color:#59873A;">generagtePattern</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">user.get.master</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">,</span><span style="color:#AB5959;"> </span><span style="color:#1E754F;">false</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">await</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">subscriber</span><span style="color:#999999;">.</span><span style="color:#59873A;">subscribe</span><span style="color:#999999;">(</span><span style="color:#B07D48;">pattern</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">message</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#999999;">{</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">id</span><span style="color:#999999;">,</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">data</span><span style="color:#999999;">,</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">pattern</span><span style="color:#999999;">,</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">isEmitter</span><span style="color:#AB5959;"> </span><span style="color:#999999;">}</span><span style="color:#AB5959;"> = </span><span style="color:#59873A;">parseEventDataFromGateway</span><span style="color:#999999;">(</span><span style="color:#B07D48;">message</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">Message: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">message</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">Event ID: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">id</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">Data: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">data</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">Pattern: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">pattern</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">isEmitter: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">isEmitter</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// ⚠️ 注意下这里，这个的 event 是 pattern.reply！</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">await</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">publisher</span><span style="color:#999999;">.</span><span style="color:#59873A;">publish</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">`</span><span style="color:#999999;">${</span><span style="color:#B56959;">pattern</span><span style="color:#999999;">}</span><span style="color:#B56959;">.reply</span><span style="color:#B56959AA;">`</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#59873A;">generagteResponse</span><span style="color:#999999;">(</span><span style="color:#B07D48;">id</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{ </span><span style="color:#998418;">name</span><span style="color:#999999;">: </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">test</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;"> }))</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span></code></pre></div><p>这样便是一个简单易启动的服务啦！使用 node^18 更可以使用其实验性功能：<code>--watch</code> 直接监听文件变化重载程序</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#80A665;">node</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C99076;">--watch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">service.js</span></span>
<span class="line"></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#59873A;">node</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">--watch</span><span style="color:#393A34;"> </span><span style="color:#B56959;">service.js</span></span>
<span class="line"></span></code></pre></div><p><img src="https://cdn.my-api.cn/user/w/asset-pic-picgo/2023-01-202301102241094.jpeg" alt=""></p><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-hidden="true">#</a></h2><p>注意的是：一个事件只能由一个服务受理，否则则会出现冲突情况。别问我问什么，问就是写的时候卡这个问题了。但是一个事件（Event-based）可以调度到多个方法</p><blockquote><p>You can register multiple event handlers for a single event pattern and all of them will be automatically triggered in parallel. -- <a href="https://docs.nestjs.com/microservices/basics" target="_blank" rel="noreferrer">NestJS Documentaion</a></p></blockquote><p>因此，在编码的时候，不要与现有的服务监听的事件冲突，否则会出现不可预知的情况。</p></div></div><p class="edit-link" data-v-09373ad3><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor" class="vt-icon" data-v-09373ad3><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg><a class="vt-link link" href="https://github.com/mogland/mog-docs/edit/main/src/developer/extend-service.md" target="_blank" rel="noopener noreferrer" data-v-09373ad3><!--[-->为此页提供修改建议<!--]--><!----></a></p></main><!--[--><!--]--><footer class="VPContentDocFooter" data-v-09373ad3 data-v-03c72ecc><a class="prev-link" href="/config/" data-v-03c72ecc><span class="desc" data-v-03c72ecc><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-link-icon" data-v-03c72ecc><path d="M15,19c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4l6-6c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4L10.4,12l5.3,5.3c0.4,0.4,0.4,1,0,1.4C15.5,18.9,15.3,19,15,19z"></path></svg> Previous</span><span class="title" data-v-03c72ecc>配置索引</span></a><!----></footer></div></div></div></div><div class="visually-hidden" aria-live="polite" data-v-732aa6ea>拓展新的服务模块 has loaded</div></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"about_code-of-conduct.md\":\"28632809\",\"about_faq.md\":\"fc8884f8\",\"about_releases.md\":\"bd386270\",\"about_roadmap.md\":\"03052f87\",\"guide_features.md\":\"652fa36b\",\"guide_why.md\":\"c38b5e69\",\"install_build.md\":\"3b749e6d\",\"guide_index.md\":\"fde1cadd\",\"developer_index.md\":\"d167189a\",\"config_index.md\":\"b9e4cd07\",\"index.md\":\"f5210cec\",\"developer_extend-service.md\":\"51a30c08\",\"install_index.md\":\"791f7e3e\",\"migrate_index.md\":\"b4f6173d\",\"migrate_from-other.md\":\"258d3cc4\"}")</script>
    <script type="module" async src="/assets/app.bbe1740c.js"></script>
    
  </body>
</html>