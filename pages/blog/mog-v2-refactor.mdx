---
title: Mog 2.0 重构开始
description: Hi, 我们离开了比较久的时间，期间甚至将组织换了一个名字，实际上我们正在重构 Mog 2.0，它将会是一个全新的版本，我们将会在这里记录我们的重构过程。
date: 2022-09-24
---

import { Tab, Tabs, Callout } from 'nextra-theme-docs'

# Mog 2.0 重构开始

## `第一阶段` - 新名字 "Mog"

从 NEXT 到 Mog 是一个比较惨痛的过程，已经有一部分人知道此项目了，他们通常称之为 _"nx"_，现在修改这个名字对宣传来说并不是一件好事，但为了以后的发展我们必须这样做。

新的名字由两个单词组成：**Module + Blog = Mog**，这和我们在 v2 版本的构思有关。我们在 v2 突破地采用了**微服务架构**，对于不同的服务分离，我们仍在探索当中，相信出版的时候可以寻找到一个较好的方案。

## 一些 Q&A

### 为什么突然要重构？

1.x 版本由于更新仓促，导致了很多的问题，比如：

- API RESTFul **规范**
- DTO 与 Model **不匹配**，导致输出存在问题
- 接口方法**书写混乱**
- 注释**不规范**
- 很难继续向上堆积功能，原架构会导致**功能臃肿**

为了长久的发展，我们发布了最后的 v1.7.0，并立即开始了 v2 的重构

### 这次更新有什么新功能或者优势？

1. 2.x 版本将会**内置后台**，无需额外部署，也不应额外部署，这会增加更多的在意料之外的维护成本
2. 2.x 使用**微服务架构**，**扩展性**对比单一服务高了很多，且一个微服务的异常不会导致其它微服务同时异常，**增强稳定性**
3. **评论模块、邮件模块、友链模块、渲染模块**将会独立为一个单独服务
4. 我们对文档进行了重写，重新使用了 Vitepress，并且参照了许多优秀的开源项目编写相关文档
5. 评论模块将会考虑与其他博客系统相兼容，并且提供独立的控制台
6. 邮件模块将会寓于交流模块之内，交流模块将会负责一切与交流相关的功能
7. 友链模块我们会考虑将其可以作为一个独立的友链页面，并且支持主题定制
8. 渲染模块我们会提供一个 Tiny markdown Server，推动更多的自定义语法渲染处理

### 这次更新的问题是什么？

1. 1.x --> 2.x 预计会出现较多接口不兼容的情况，因此除核心外的生态需要全部重写
2. 由于 2.x 使用微服务架构，因此文档部署需要全部重写，建议全部重新开始.
3. 该版本的制作时间会大大增长，有可能需要到下一个假期才可基本完成.

## `第二阶段` - 重构基础服务

第一阶段，我们居多是进行路径规划，后续阶段，我们会加紧进行基础服务的重构，在完成所有基础服务的时候我们将会发布一次 Alpha 文档。我们目前已完成重构的基础服务有：

- 数据库模块 （[mogland/core#309](https://github.com/mogland/core/pull/309)）
- 授权模块 （ [mogland/core#309](https://github.com/mogland/core/pull/309) ）
- 配置模块 （ [mogland/core#336](https://github.com/mogland/core/pull/336) ）
- 用户服务模块 （ [mogland/core#348](https://github.com/mogland/core/pull/348) ）
- 文库模块 （ [mogland/core#363](https://github.com/mogland/core/pull/363) ）
- 数据聚合模块 （ [mogland/core#396](https://github.com/mogland/core/pull/396) ）

余下的服务模块我们将会在下一阶段继续加紧重构，在此之前，我们需要对某些模块撰写 RFC。

### 距离 2.0 还有多远？

> 很接近，但也很遥远

我们已经在全力开发，但是我们还需要一些时间来完成，我们将会在 2022 春节前完成 v2.0 的开发，但是我们不会在这个时间点发布，我们将会在 2022 春节后发布 v2.0，我们将会在发布前进行一些测试，以确保 v2.0 的稳定性。

我们目前遇到的困难包括且不限于：*人手不足、架构考虑、规划不足* 

**我们真的很希望有更多的人能够加入我们。**

## `第三阶段` - 重构生态服务

### 核心所有服务已成功重写

如果你有关注我们的开发进度，你能发现我们已经将所有的服务都重写完成了。至此，Mog v2 的核心部分已经基本完成，目前我们正在进行一些发布前的测试以及部分模块中的功能补充与优化。

此次新增的模块有：

-  分类 / 标签 + 文章 / 页面的服务模块 ( PR in [mogland/core#363](https://github.com/mogland/core/pull/363) )
-  ~~基本评论模块 ( PR in [mogland/core#404](https://github.com/mogland/core/pull/404), 于 [mogland/core#558](https://github.com/mogland/core/pull/558) 已移除)~~
-  评论服务模块 (PR in [mogland/core#558](https://github.com/mogland/core/pull/558) )
-  数据聚合模块 ( PR in [mogland/core#396](https://github.com/mogland/core/pull/396) )
-  友链服务模块 ( PR in [mogland/core#565](https://github.com/mogland/core/pull/565))
-  ~~基本友链模块 ( PR in [mogland/core#511](https://github.com/mogland/core/pull/511)，于 [mogland/core#565](https://github.com/mogland/core/pull/565) 已移除)~~
-  通知模块 (PR in [mogland/core#568](https://github.com/mogland/core/pull/568))


<Callout type="info">
  **可能你会感到疑惑，为什么我们在后续的 PR 中移除了基本模块？**
  目前的设计结构暂时对基础内置模块的支持并不是很友好，将会极大提高其编码时的复杂度，我们可能会在后续的版本中重新设计这部分的内容，这取决于用户是否需要基本模块。
</Callout>

非常感谢 Mog 团队成员对这部分代码的贡献，我们将继续提高核心模块的代码质量与稳定性。

### 新的控制台 UI 已就绪！

全新的 core，肯定要有全新的控制台 UI，我们在过去的时间里，对控制台 UI 进行了大量的重构，目前已经基本完成了。

我们依然使用了 React 作为控制台 UI 的开发框架，以及在设计上依然保持了与原来的控制台 UI 的风格基本一致，但是我们对控制台 UI 的设计进行了部分的优化，使得控制台 UI 更加的简洁。

![](https://user-images.githubusercontent.com/62133302/212527878-cb415e34-50d4-4522-a257-70965d9a558e.png)


### 新文档首页

我们又一次重写了文档首页，实际上是从 [Vuejs](//Vuejs.org) Fork 的，我们对其中的一些内容做了一些修改，并且在添加了一些章节。

你可以在这里看到新的首页：https://mog.js.org/


### 接下来我们要做的

我们需要将 v1 生态全部迭代至 v2，这依然是一个很长且困难的过程，我们将会在接下来的时间里继续努力。

此外，我们需要重写全部评论模块，目前的评论数据设计已经可以支持在不同的站点中使用了～

## `第四阶段` - 加入部分特性

> 全部修改日志在 #605 

### 主题系统 <small>by @wibus-wee</small>

我们新增了一个主题系统服务 (themes-service)，它将配有 Fastify + `@fastify/point-of-view`，目前我们支持了 `.ejs` 格式的模板引擎，在 Stage 5 我们可能会加入自定义渲染器功能。

主题系统支持 i18n，配置十分方便，仅需要 `i18n.yaml` + `_i()` 即可使用：

```yaml
# config.yaml
language: zh # or `en`

# i18n.yaml
en:
  hello: 'Hello'
zh:
  hello: '你好'
```

```ejs
<!-- zh：你好 | en：Hello -->
<%- _i('hello') %>
```

除此之外，还支持了自定义主题插件支持，它能让你在渲染前处理某些数据，不过目前它还有些**缺陷**，有待 Stage 5 中继续改进。


### 重新设计 Core README <small>by @wibus-wee</small>

总是认为之前的 README 太过花哨，而我们在第四阶段中，重新设计了 README。

- 移除了 `Motivation 动机` 章节
- 移除了 `Table of Contents 目录`章节
- 重新设计了 `Contributors` 章节
- 移除了 `Activity` 章节
- 移除了 `@allcontributors` 机器人
- 国际化 README
- 将 `##` --> `###`，以去除默认样式中过长的下划线

与我们而言，这是一个小改进。

### [Core] 支持内置控制台 <small>by @wibus-wee</small>

为了便捷性，我们将控制台移入了 Core Gateway 服务中，需要注意的是，它并不是由模板引擎制作的，控制台的仓库依然在 [mogland/console](https://github.com/mogland/console)，但 Core 将会把全部请求转接到后端中，把 Cookie 等注入请求返回中，请求远端 HTML 等文件，将内容返回。

我们增加了关于后台的自定义配置，由于这项功能仍处于测试阶段，我们默认将会把它关闭，如果需要启动你需要在配置文件中启动它。相关文档已更新

### 全新的评论组件 mog-comments-wc <small>by @wibus-wee</small>

Mog 评论服务的设计初衷是为了让用户可以在自己的网站上使用评论功能，但是也可以在其他更多的地方使用。因此它更像是一个独立的评论系统，而不是一个专属于 Mog 的内部组件。

为了方便主题开发，我们使用 @jwcjs 开发了通用的评论组件。多亏于 Mog 评论服务的设计，它可以在任何地方使用，比如 `Hexo`。在后期我们将会实现对应的专属评论控制面板

<img src="https://user-images.githubusercontent.com/62133302/215319021-147d3c16-0da6-4684-a8e1-c0e3b783accd.png" width="700" />